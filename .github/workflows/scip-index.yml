name: Generate SCIP Indexes (Docker)

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [ main, master, develop ]
  workflow_dispatch:

# Add this permissions block
permissions:
  contents: read
  pull-requests: read

jobs:
  generate-scip-indexes:
    runs-on: ubuntu-latest
    container:
      image: ttl.sh/kusari-indexer:latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        persist-credentials: false

    - name: Fetch base branch for PR comparison
      if: github.event_name == 'pull_request'
      run: |
        git fetch origin ${{ github.event.pull_request.base.ref }}:${{ github.event.pull_request.base.ref }}

    - name: Verify SCIP tools
      run: |
        echo "=== Verifying pre-installed SCIP tools ==="
        scip-go --help
        scip-typescript --help
        scip-python --help
        scip-java --help
        echo "âœ… All SCIP tools are ready!"
    
    - name: Generate SCIP indexes
      id: scip
      uses: kusari-sandbox/kusari-indexer@v0.1.6
