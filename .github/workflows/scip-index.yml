name: Generate SCIP Indexes (Docker)

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [ main, master, develop ]
  workflow_dispatch:

# Add this permissions block
permissions:
  contents: read
  pull-requests: read

jobs:
  generate-scip-indexes:
    runs-on: ubuntu-latest
    container:
      image: ttl.sh/kusari-indexer:latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        persist-credentials: false

    - name: Generate SCIP indexes
      id: scip
      uses: kusari-sandbox/kusari-indexer@v0.1.15
      with:
          kusari-client-id: ${{ secrets.KUSARI_CLIENT_ID }}
          kusari-client-secret: ${{ secrets.KUSARI_CLIENT_SECRET }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

